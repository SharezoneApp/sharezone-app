<!DOCTYPE html>
<!--
 Copyright (c) 2022 Sharezone UG (haftungsbeschränkt)
 Licensed under the EUPL-1.2-or-later.

 You may obtain a copy of the Licence at:
 https://joinup.ec.europa.eu/software/page/eupl

 SPDX-License-Identifier: EUPL-1.2
-->

<html>

<head>
    <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
    <base href="$FLUTTER_BASE_HREF">

    <meta charset="UTF-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">

    <!-- Caching of HTML for about 6 hours-->
    <meta http-equiv="cache-control" content="max-age=21600" />

    <!-- iOS meta tags & icons -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="fix">
    <link rel="apple-touch-icon" href="icons/Icon-192.png">

    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="manifest" href="manifest.json">


    <!-- SEO and SMO -->
    <meta name="description"
        content="Sharezone ist ein vernetzter Schulplaner, mit dem sich Schüler, Lehrkräfte und Eltern gemeinsam, schnell und datenschutzkonform organisieren können.">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png" />

    <title>Sharezone</title>

    <meta name="theme-color" content="#40c4ff">
    <link rel="stylesheet" href="index.css" type="text/css" media="screen,projection">

    <!-- Required for QR Login -->
    <script src="assets/packages/fast_rsa/web/assets/wasm_exec.js" type="application/javascript"></script>

    <!-- Required for the "mobile_scanner" package, see
    https://pub.dev/packages/mobile_scanner#web. Copied the file from
    https://unpkg.com/@zxing/library@0.19.1. We copied the file into the source
    code to be more GDPR friendly (client avoid making a request to a third
    party service) -->
    <script src="https://unpkg.com/@zxing/library@0.19.1" type="application/javascript"></script>
</head>

<body>
    <noscript>
        We're sorry but Sharezone doesn't work properly without JavaScript enabled. Please enable it to
        continue.
    </noscript>
    <script src="flutter_bootstrap.js" async></script>

    <div class="spinner">
        <div class="double-bounce1"></div>
        <div class="double-bounce2"></div>
    </div>

    <div id="error-container" class="error-container" role="alert" aria-live="assertive" hidden>
        <p>
            An error occurred. Please reload the page. If the problem persists,
            contact <a href="mailto:support@sharezone.net">support@sharezone.net</a>.
        </p>
        <ul id="error-list"></ul>
    </div>

    <!-- Required for the pdfx package -->
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@2.12.313/build/pdf.js" type="text/javascript"></script>
    <script type="text/javascript">
        pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdn.jsdelivr.net/npm/pdfjs-dist@2.12.313/build/pdf.worker.min.js";
        pdfRenderOptions = {
            cMapUrl: 'https://cdn.jsdelivr.net/npm/pdfjs-dist@2.12.313/cmaps/',
            cMapPacked: true,
        }
    </script>

    <!-- Error handling -->
    <script type="text/javascript">
        (function () {
            const container = document.getElementById('error-container');
            const list = document.getElementById('error-list');
            if (!container || !list) {
                return;
            }

            const seenMessages = new Set();

            function hideSpinner() {
                const spinner = document.querySelector('.spinner');
                if (spinner) {
                    spinner.style.display = 'none';
                }
            }

            function normalizeMessage(value) {
                if (!value) {
                    return '';
                }
                if (typeof value === 'string') {
                    return value;
                }
                if (value && typeof value.message === 'string') {
                    return value.message;
                }
                try {
                    return JSON.stringify(value);
                } catch (error) {
                    return String(value);
                }
            }

            function showError(message) {
                const text = message || 'Unknown error.';
                if (!seenMessages.has(text)) {
                    seenMessages.add(text);
                    const entry = document.createElement('li');
                    entry.textContent = text;
                    list.appendChild(entry);
                }
                container.hidden = false;
                hideSpinner();
            }

            window.addEventListener('error', function (event) {
                showError(event?.message);
            });

            window.addEventListener('unhandledrejection', function (event) {
                const text = normalizeMessage(event?.reason);
                showError(text);
            });
        })();
    </script>
</body>

</html>
